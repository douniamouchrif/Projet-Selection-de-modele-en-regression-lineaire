---
title: "Projet - Sélection de modèle en régression linéaire"
author: 'Université de Bordeaux - M1 Master MAS - UE : Modèles de régression'
date: "Année 2023-2024"
output:
  html_document:
    df_print: paged
  pdf_document:
    number_sections: yes
fontsize: 11pt
---

**Nom : **ABARKAN
**Prénom : **Suhaila

**Nom : **MOUCHRIF
**Prénom : **Dounia

**Nom : **TISSANDIER
**Prénom : **Mathilde

\newtheorem{question}{Question}
\newtheorem{definition}{Definition}

\newcommand{\Var}{\mbox{Var}}
\newcommand{\Cov}{\mbox{Cov}}

**Préambule**

Dans ce projet, il est proposé de s'intéresser à l'analyse d'un jeu de données réelles disponible à l'URL : https://www.openlab.psu.edu/ansur2/.

Il s'agit du jeu de données ``ANSUR II`` (Anthropometric Survey of US Army Personnel) relatives à des caractéristiques de taille et forme du corps humain. Il s’agit d’un ensemble de 93 mesures effectuées sur plus de 6 000 militaires américains adultes, dont 4 082 hommes et 1 986 femmes. On va proposer de choisir l'une des variables (par exemple le poids d'un individu) et chercher à l'expliquer en fonction des $p=92$ autres variables du jeu de données à l'aide d'un modèle linéaire. Le but de votre analyse statistique est de trouver un sous-ensemble (de petite taille) de variables qui permettent de bien expliquer le poids d'individu. Lors de votre avancée dans le projet, vous pourrez aussi considérer une autre variable à expliquer en fonction des autres comme par exemple la taille d'un individu.

Pour vous guider dans l'explication du nom des variables en Anglais, vous pourrez consulter ce document très détaillé sur ce jeu de données qui propose en particulier une traduction en Français du nom des variables ainsi qu'une étude descriptive de la répartition de leurs valeurs entre les hommes et les femmes :

https://pbil.univ-lyon1.fr/R/pdf/pps100.pdf

**Travail à effectuer par groupe de 2 ou 3 étudiants.** Vous devez rendre sous la forme d'un unique rapport en .html produit à partir de Rmarkdown (en incluant uniquement le code nécessaire aux conclusions pertinentes de votre étude) : 

- une analyse de statistique descriptive du jeu de données (par exemple : utiliser des Boxplots, méthode de visualisation d'une matrice de corrélation, analyse en composantes principales)

- décrire votre méthode de sélection de modèle pour expliquer le poids (ou bien la taille) d'un individu en fonction d'un petit nombre de variables pertinentes

- distinguer éventuellement dans votre analyse statitique les hommes et les femmes

On veillera à privilégier des tableaux et des outils graphiques pour rendre compte des conclusions de votre étude.

**Prise en main des données**
 
```{r eval=TRUE, warning=FALSE, error = TRUE, message=FALSE}
# Lecture des données ANSUR

ansurm = read.csv('ANSUR_II_MALE_Public.csv')
ansurf = read.csv('ANSUR_II_FEMALE_Public.csv')

p = 93 # Nombre de variables morphométriques
names(ansurm)
names(ansurf)

donnees_m = ansurm[2:(p+1)]
donnees_f = ansurf[2:(p+1)]
nom_variables = names(ansurm)[2:(p+1)]
print(nom_variables)

# Choix de la variable à expliquer
indices = 1:p
pos = indices[nom_variables == "weightkg"]
# pos = indices[nom_variables == "stature"]

Y_m = donnees_m[,pos]/10 # Conversion en kg
X_m = donnees_m[,-pos] #92 variables sans la varibale pos
dim(X_m)

Y_f = donnees_f[,pos]/10 # Conversion en kg
X_f = donnees_f[,-pos]
dim(X_f)


# Visualisation de la répartition de la variable explicative selon le sexe
polycurve <- function(x, y, base.y = min(y), ...) {
  polygon(x = c(min(x), x, max(x)), y = c(base.y, y, base.y), ...)
}

colM = rgb(0.2, 0.2, 1, 0.5)
colF = rgb(1, 0.2, 0.2, 0.5)

res_f = density(Y_f)
plot(res_f$x,res_f$y,type="l",xlab="Poids en kg",ylab="")
polycurve(res_f$x, res_f$y, base.y = 0, col = colF)

res_m = density(Y_m)
lines(res_m$x,res_m$y,type="l")
polycurve(res_m$x, res_m$y, base.y = 0, col = colM)

legend(100, 0.035, legend=c("Hommes", "Femmes"),fill=c(colM, colF))
title('Répartition de la variable Y')
```

**Analyse descriptive**

```{r}
library(corrplot)
library(ade4)
```

#Main
```{r}
main <- c("handbreadth", "handcircumference", "handlength", "palmlength")
```
##HOMMES
```{r}
imain_m <- which(!is.na(match(main, names(X_m))))
names(X_m)[imain_m] <- c("MlargeurMain", "McironférenceMain", "MlongueurMain", "MlongueurPaumeMain")
names(X_m)[grep("Main", names(X_m))]

###Corrélation
M_m = cor(X_m[imain_m])
corrplot(M_m, order="hclust", method = 'color')

###ACP
tmpMM <- X_m[ , imain_m]
acp_m_m <- dudi.pca(tmpMM, scannf = FALSE, scale = FALSE)
s.corcircle(acp_m_m$co, clabel = 0.5)

###Boxplot

```
##FEMMES
```{r}
imain_f <- which(!is.na(match(main, names(X_f))))
names(X_f)[imain_f] <- c("FlargeurMain", "FcironférenceMain", "FlongueurMain", "FlongueurPaumeMain")
names(X_f)[grep("Main", names(X_f))]

###Corrélation
M_f = cor(X_f[imain_f])
corrplot(M_f, order="hclust", method = 'color')

###ACP
tmpMF <- X_f[ , imain_f]
acp_m_f <- dudi.pca(tmpMF, scannf = FALSE, scale = FALSE)
s.corcircle(acp_m_f$co, clabel = 0.5)
```


#Pied
```{r}
pied <- c("balloffootcircumference", "balloffootlength", "bimalleolarbreadth",
          "footbreadthhorizontal", "footlength", "heelbreadth", "lateralmalleolusheight",
          "anklecircumference", "heelanklecircumference")
```
##HOMMES
```{r}
ipied_m <- which(!is.na(match(pied, names(X_m))))
names(X_m)[ipied_m] <-
   c("MciconférencePied", "MlongueurArrièrePied", "MlargeurBimalléolairePied",
     "MlargeurPied", "MlongueurPied", "MlargeurTalonPied", "MhauteurMalléolairePied",
     "McirconférenceChevillePied", "McirconférenceChevilleTalonPied")
names(X_m)[grep("Pied", names(X_m))]

###Corrélation
P_m = cor(X_m[ipied_m])
corrplot(P_m, order="hclust", method = 'color')

###ACP
tmpPM <- X_m[ , ipied_m]
acp_p_m <- dudi.pca(tmpPM, scannf = FALSE, scale = FALSE)
s.corcircle(acp_p_m$co, clabel = 0.5)
```
##FEMMES
```{r}
ipied_f <- which(!is.na(match(pied, names(X_f))))
names(X_f)[ipied_f] <-
   c("FciconférencePied", "FlongueurArrièrePied", "FlargeurBimalléolairePied",
     "FlargeurPied", "FlongueurPied", "FlargeurTalonPied", "FhauteurMalléolairePied",
     "FcirconférenceChevillePied", "FcirconférenceChevilleTalonPied")
names(X_f)[grep("Pied", names(X_f))]

###Corrélation
P_f = cor(X_f[ipied_f])
corrplot(P_f, order="hclust", method = 'color')

###ACP
tmpPF <- X_f[ , ipied_f]
acp_p_f <- dudi.pca(tmpPF, scannf = FALSE, scale = FALSE)
s.corcircle(acp_p_f$co, clabel = 0.5)
```


#Tete
```{r}
tete <- c("bitragionchinarc", "bitragionsubmandibulararc", "bizygomaticbreadth",
          "headbreadth", "headcircumference", "interpupillarybreadth", "earbreadth",
          "earlength", "earprotrusion", "headlength", "mentonsellionlength",
          "neckcircumference", "neckcircumferencebase", "tragiontopofhead")
```
##HOMMES
```{r}
itete_m <- which(!is.na(match(tete, names(X_m))))
names(X_m)[itete_m] <-
  c("MarcMentonTête", "MarcCouTête", "MlargeurJouesTête", "MlargeurTête",
    "McirconférenceTête", "MlargeurYeuxTête", "MlargeurOreilleTête",
    "MlongueurOreilleTête", "MdécollementOreilleTête", "MlongueurTête",
    "MlongueurMentonTête", "McirconférenceCouTête", "McirconférenceCouBaseTête",
    "MhauteurTête")
names(X_m)[grep("Tête", names(X_m))]

###Corrélation
T_m = cor(X_m[itete_m])
corrplot(T_m, order="hclust", method = 'color')

###ACP
tmpTM <- X_m[ , itete_m]
acp_t_m <- dudi.pca(tmpTM, scannf = FALSE, scale = FALSE)
s.corcircle(acp_t_m$co, clabel = 0.5)
```
##FEMMES
```{r}
itete_f <- which(!is.na(match(tete, names(X_f))))
names(X_f)[itete_f] <-
  c("FarcMentonTête", "FarcCouTête", "FlargeurJouesTête", "FlargeurTête",
    "FcirconférenceTête", "FlargeurYeuxTête", "FlargeurOreilleTête",
    "FlongueurOreilleTête", "FdécollementOreilleTête", "FlongueurTête",
    "FlongueurMentonTête", "FcirconférenceCouTête", "FcirconférenceCouBaseTête",
    "FhauteurTête")
names(X_f)[grep("Tête", names(X_f))]

###Corrélation
T_f = cor(X_f[itete_f])
corrplot(T_f, order="hclust", method = 'color')

###ACP
tmpTF <- X_f[ , itete_f]
acp_t_f <- dudi.pca(tmpTF, scannf = FALSE, scale = FALSE)
s.corcircle(acp_t_f$co, clabel = 0.5)
```


#Bras
```{r}
bras <- c("span", "sleevelengthspinewrist", "radialestylionlength", "sleeveoutseam",
          "wristcircumference", "forearmhandlength", "forearmcenterofgriplength",
          "thumbtipreach", "bicepscircumferenceflexed", "forearmcircumferenceflexed",
          "acromionradialelength", "shoulderelbowlength")
```
##HOMMES
```{r}
ibras_m <- which(!is.na(match(bras, names(X_m))))
names(X_m)[ibras_m] <- 
  c("MempanBras", "MlongueurMancheBras", "MlongueurAvantBras", "MlongueurMancheSeuleBras",
    "McirconférencePoignetBras", "MlongueurAvantBrasMain", "MlongueurAvantBrasPoing",
    "MlongueurDosPoingBras", "McirconférenceBicepsBras", "McirconférenceAvantBras",
    "MlongueurArrièreBras", "MlongueurÉpauleCoudeBras")
names(X_m)[grep("Bras", names(X_m))]

###Corrélation
B_m = cor(X_m[ibras_m])
corrplot(B_m, order="hclust", method = 'color')

###ACP
tmpBM <- X_m[ , ibras_m]
acp_b_m <- dudi.pca(tmpBM, scannf = FALSE, scale = FALSE)
s.corcircle(acp_b_m$co, clabel = 0.5)
```
##FEMMES
```{r}
ibras_f <- which(!is.na(match(bras, names(X_f))))
names(X_f)[ibras_f] <- 
  c("FempanBras", "FlongueurMancheBras", "FlongueurAvantBras", "FlongueurMancheSeuleBras",
    "FcirconférencePoignetBras", "FlongueurAvantBrasMain", "FlongueurAvantBrasPoing",
    "FlongueurDosPoingBras", "FcirconférenceBicepsBras", "FcirconférenceAvantBras",
    "FlongueurArrièreBras", "FlongueurÉpauleCoudeBras")
names(X_f)[grep("Bras", names(X_f))]

###Corrélation
B_f = cor(X_f[ibras_f])
corrplot(B_f, order="hclust", method = 'color')

###ACP
tmpBF <- X_f[ , ibras_f]
acp_b_f <- dudi.pca(tmpBF, scannf = FALSE, scale = FALSE)
s.corcircle(acp_b_f$co, clabel = 0.5)
```  


```{r}
####HOMMES
subset_X_m <- X_m[, bras_names_m]
data_matrix <- cbind(Y_m, subset_X_m)
model_poids_bras_m <- lm(Y_m ~ ., data = data_matrix)
summary(model_poids_bras_m)

####FEMMES
subset_X_f <- X_f[, bras_names_f]
data_matrix <- cbind(Y_f, subset_X_f)
model_poids_bras_f <- lm(Y_f ~ ., data = data_matrix)
summary(model_poids_bras_f)
```

#Tronc
```{r}
torse <- c("buttockcircumference", "chestcircumference", "shouldercircumference",
           "waistcircumference", "verticaltrunkcircumferenceusa", "waistdepth", "chestdepth",
           "crotchlengthomphalion", "abdominalextensiondepthsitting", "shoulderlength",
           "biacromialbreadth", "bideltoidbreadth", "forearmforearmbreadth",
           "hipbreadthsitting", "waistfrontlengthsitting", "interscyei", "interscyeii",
           "waistbacklength", "bicristalbreadth", "chestbreadth", "hipbreadth", 
           "waistbreadth", "buttockdepth", "crotchlengthposterioromphalion")
```

##Hommes
```{r}
itorse_m <- which(!is.na(match(torse, names(X_m))))
names(X_m)[itorse_m] <-
   c("McirconférenceFessesTorse", "McirconférencePoitrineTorse",
     "McirconférenceÉpauleTorse", "McirconférenceNombrilTorse",
     "McirconférenceVerticaleTorse", "MprofondeurTorseDebout", "MprofondeurTorsePointrine",
     "MarcTorseBas", "MprofondeurTorseAssis", "MlargeurÉpauleTorse",
     "MlargeurÉpauleIntTorse", "MlargeurÉpauleExtTorse", "MlargeurCoudeCoudeTorse",
     "MlargeurHanchesAssisTorse", "MlongueurTorse", "MlargeurDosITorse", "MlargeurDosIITorse",
     "MhauteurDosTorse", "MlargeurDessusNombrilTorse", "MlargeurPoitrineTorse",
     "MlargeurHancheTorse", "MlargeurNombrilTorse", "MprofondeurFesseTorse", "MarcFesseTorse")
names(X_m)[grep("Torse", names(X_m))]

###Corrélation
T_m = cor(X_m[itorse_m])
corrplot(T_m, order="hclust", method = 'color')

###ACP
tmp <- X_m[ , itorse_m]
acptmp <- dudi.pca(tmp, scannf = FALSE, scale = FALSE)
s.corcircle(acptmp$co, clabel = 0.5)

###Boxplot


```

##Femmes
```{r}
itorse_f <- which(!is.na(match(torse, names(X_f))))
names(X_f)[itorse_f] <-
   c("FcirconférenceFessesTorse", "FcirconférencePoitrineTorse",
     "FcirconférenceÉpauleTorse", "FcirconférenceNombrilTorse",
     "FcirconférenceVerticaleTorse", "FprofondeurTorseDebout", "FprofondeurTorsePointrine",
     "FarcTorseBas", "FprofondeurTorseAssis", "FlargeurÉpauleTorse",
     "FlargeurÉpauleIntTorse", "FlargeurÉpauleExtTorse", "FlargeurCoudeCoudeTorse",
     "FlargeurHanchesAssisTorse", "FlongueurTorse", "FlargeurDosITorse", "FlargeurDosIITorse",
     "FhauteurDosTorse", "FlargeurDessusNombrilTorse", "FlargeurPoitrineTorse",
     "FlargeurHancheTorse", "FlargeurNombrilTorse", "FprofondeurFesseTorse", "FarcFesseTorse")
names(X_f)[grep("Torse", names(X_f))]

###Corrélation
T_f = cor(X_f[itorse_f])
corrplot(T_f, order="hclust", method = 'color')

###ACP
tmp <- X_f[ , itorse_f]
acptmp <- dudi.pca(tmp, scannf = FALSE, scale = FALSE)
s.corcircle(acptmp$co, clabel = 0.5)

###Boxplot


```

#Jambe
```{r}
jambe <- c("functionalleglength",
   "buttockkneelength", "buttockpopliteallength", "kneeheightsitting", "poplitealheight",
   "thighclearance",
   "tibialheight",
   "kneeheightmidpatella", "lateralfemoralepicondyleheight",
   "calfcircumference", "lowerthighcircumference", "thighcircumference")
```

##Hommes
```{r}
ijambe_m <- which(!is.na(match(jambe, names(X_m))))
colnames(X_m)[ijambe_m] <-
   c("MlongueurJambe",
   "MlongueurGenouFesseJambe", "MlongueurPoplitealFesseJambe", "MlongeurGenouJambe", "MlongueurPoplitealJambe",
   "MépaisseurCuisseJambe",
   "MlongueurTibiaJambe",
   "MhauteurGenouDeboutJambe", "MhauteurGenouCotéJambe",
   "McirconférenceMolletJambe", "McirconférenceGenouJambe", "McirconférenceCuisseJambe")  
names(X_m)[grep("Jambe", names(X_m))]

###Corrélation
jambe_m_cor = cor(X_m[ijambe_m])
corrplot(jambe_m_cor,order="hclust", method = 'color')

###ACP
tmp <- X_m[ , ijambe_m]
acptmp <- dudi.pca(tmp, scannf = FALSE, scale = FALSE)
s.corcircle(acptmp$co, clabel = 0.5)

###Boxplot


```

##Femmes
```{r}
ijambe_f <- which(!is.na(match(jambe, names(X_f))))
colnames(X_f)[ijambe_f] <-
   c("FlongueurJambe",
   "FlongueurGenouFesseJambe", "FlongueurPoplitealFesseJambe", "FlongeurGenouJambe", "FlongueurPoplitealJambe",
   "FépaisseurCuisseJambe",
   "FlongueurTibiaJambe",
   "FhauteurGenouDeboutJambe", "FhauteurGenouCotéJambe",
   "FcirconférenceMolletJambe", "FcirconférenceGenouJambe", "FcirconférenceCuisseJambe")  
names(X_f)[grep("Jambe", names(X_f))]

###Corrélation
jambe_f_cor = cor(X_f[ijambe_f])
corrplot(jambe_f_cor,order="hclust", method = 'color')

###ACP
tmp <- X_f[ , ijambe_f]
acptmp <- dudi.pca(tmp, scannf = FALSE, scale = FALSE)
s.corcircle(acptmp$co, clabel = 0.5)

###Boxplot


```

#Stature
```{r}
stature <- c("overheadfingertipreachsitting",
   "elbowrestheight", "eyeheightsitting", "sittingheight",
   "axillaheight", "chestheight", "iliocristaleheight",
   "tenthribheight", "suprasternaleheight", "waistheightomphalion",
   "crotchheight", "buttockheight", "trochanterionheight",
   "stature", "cervicaleheight", "acromialheight", "wristheight")
```

##Hommes
```{r}
istature_m <- which(!is.na(match(stature, names(X_m))))
colnames(X_m)[istature_m] <-
   c("MassisPlafondStature",
   "MhauteurCoudeAssisStature", "MhauteurYeuxAssisStature", "MhauteurAssisStature",
   "MhauteurAisselleStature", "MhauteurPoitrineStature", "MhauteurPliCoudeStature",
   "MhauteurCôteStature", "MhauteurSternumStature", "MhauteurNombrilStature",
   "MhauteurBasFesseStature", "MhauteurBoutFesseStature", "MhauteurHautFesseStature",
   "MtailleStature", "MhauteurCouStature", "MhauteurÉpauleStature", "MHauteurPoignetStature")
names(X_m)[grep("Stature", names(X_m))]

###Corrélation
stature_m_cor = cor(X_m[istature_m])
corrplot(stature_m_cor,order="hclust", method = 'color')

###ACP
tmp <- X_m[ , istature_m]
acptmp <- dudi.pca(tmp, scannf = FALSE, scale = FALSE)
s.corcircle(acptmp$co, clabel = 0.5)

###Boxplot


```

##Femmes
```{r}
istature_f <- which(!is.na(match(stature, names(X_f))))
colnames(X_f)[istature_f] <-
   c("FassisPlafondStature",
   "FhauteurCoudeAssisStature", "FhauteurYeuxAssisStature", "FhauteurAssisStature",
   "FhauteurAisselleStature", "FhauteurPoitrineStature", "FhauteurPliCoudeStature",
   "FhauteurCôteStature", "FhauteurSternumStature", "FhauteurNombrilStature",
   "FhauteurBasFesseStature", "FhauteurBoutFesseStature", "FhauteurHautFesseStature",
   "FtailleStature", "FhauteurCouStature", "FhauteurÉpauleStature", "FhauteurPoignetStature")
names(X_f)[grep("Stature", names(X_f))]

###Corrélation
stature_f_cor = cor(X_f[istature_f])
corrplot(stature_f_cor, order="hclust", method = 'color')

###ACP
tmp <- X_f[ , istature_f]
acptmp <- dudi.pca(tmp, scannf = FALSE, scale = FALSE)
s.corcircle(acptmp$co, clabel = 0.5)


###Boxplot


```

#autres variables
```{r}

```


**Sélection de modèle**

A compléter.
```{r}
library(car)
mod = lm...  
vid(mod)
```

